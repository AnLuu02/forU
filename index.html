<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>Happy 20/10 💖</title>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        overflow: hidden;
      }
      body {
        background: radial-gradient(circle at 20% 10%, #2b0048 0%, #090009 60%);
      }

      canvas {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
      }

      h1 {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        z-index: 2;
        color: #ff9ad9;
        font-size: 2.4rem;
        font-family: "Segoe Script", cursive;
        text-shadow: 0 0 20px rgba(255, 90, 180, 0.9);
        pointer-events: none;
      }
      p {
        position: absolute;
        top: 4%;
        left: 50%;
        text-align: center;
        transform: translate(-50%, -50%);
        z-index: 2;
        color: #ff9ad9;
        font-size: 1.6rem;
        font-family: "Segoe Script", cursive;
        text-shadow: 0 0 20px rgba(255, 90, 180, 0.9);
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <h1 id="wish"></h1>
    <p>Hong nghe nhạc thì click chuột đại vào đâu đó nhaaaaa</p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <script>
      // === SCENE SETUP ===
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        50,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      const renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      document.body.appendChild(renderer.domElement);

      // LIGHTS
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      const pointLight = new THREE.PointLight(0xff88cc, 2, 200);
      pointLight.position.set(30, 50, 50);
      scene.add(ambient, pointLight);

      // HEART SHAPE
      const shape = new THREE.Shape();
      shape.moveTo(0, 5);
      shape.bezierCurveTo(0, 5, -6, 0, -6, -4);
      shape.bezierCurveTo(-6, -8, -2, -10, 0, -6);
      shape.bezierCurveTo(2, -10, 6, -8, 6, -4);
      shape.bezierCurveTo(6, 0, 0, 5, 0, 5);

      const geo = new THREE.ExtrudeGeometry(shape, {
        depth: 2,
        bevelEnabled: true,
        bevelSegments: 8,
        steps: 1,
        bevelSize: 0.8,
        bevelThickness: 0.8
      });
      geo.center();

      const mat = new THREE.MeshStandardMaterial({
        color: 0xff4da6,
        metalness: 0.3,
        roughness: 0.25,
        emissive: 0x200018,
        emissiveIntensity: 0.7
      });

      const heart = new THREE.Mesh(geo, mat);
      heart.rotation.x = -0.3;
      heart.rotation.y = 0.5;
      scene.add(heart);

      camera.position.z = 60;

      // PARTICLES
      const particles = new THREE.Group();
      const pGeo = new THREE.SphereGeometry(0.12, 8, 8);
      const pMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
      for (let i = 0; i < 150; i++) {
        const p = new THREE.Mesh(pGeo, pMat);
        const r = 25 + Math.random() * 25;
        const t = Math.random() * Math.PI * 2;
        const phi = (Math.random() - 0.5) * Math.PI * 0.7;
        p.position.set(
          Math.cos(t) * r,
          Math.sin(phi) * r * 0.5,
          Math.sin(t) * r
        );
        particles.add(p);
      }
      scene.add(particles);

      // MUSIC
      const bgMusic = new Audio("assets/background.mp3");
      bgMusic.loop = true;
      bgMusic.volume = 0.6;
      bgMusic.play().catch(() => {
        window.addEventListener("click", () => bgMusic.play(), { once: true });
      });

      // FLOATING HEART
      gsap.to(heart.scale, {
        x: 1.05,
        y: 1.05,
        z: 1.05,
        duration: 1.2,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut"
      });

      // RENDER LOOP
      function animate() {
        requestAnimationFrame(animate);
        heart.rotation.y += 0.01;
        particles.rotation.y += 0.002;
        renderer.render(scene, camera);
      }
      animate();

      // === MESSAGES ===
      const messages = [
        "💖 Happy 20/10 ẻm nha 💐",
        "Chúc ẻm luôn xinh đẹp và rạng rỡ 🌸",
        "Mọi ước mơ đều trở thành hiện thực 🌹 ",
        "Và luôn hạnh phúc như bây giờ 💕",
        "Ảnh của ẻm 💐🌻🌺🌼🌷🪻🥀🌹"
      ];
      const wish = document.getElementById("wish");
      let index = 0;

      function randomVector() {
        // Random hóa hướng xuất phát: cả X, Y, Z
        const radius = 400 + Math.random() * 300; // khoảng cách xa – gần
        const angle = Math.random() * Math.PI * 2;
        const height = (Math.random() - 0.5) * 400;
        return {
          x: Math.cos(angle) * radius,
          y: height,
          z: Math.sin(angle) * radius
        };
      }

      function showMessage() {
        if (index >= messages.length) {
          setTimeout(splitHeart, 1500);
          return;
        }

        wish.textContent = messages[index];
        wish.style.opacity = 0;
        wish.style.transform = "translate(-50%, -50%) scale(0.8)";
        wish.style.zIndex = 3;

        const dir = randomVector();
        const delayBetween = 4.8; // mỗi lời nhắn kéo dài tổng 4.8s

        // Bay từ xa tới
        gsap.fromTo(
          wish,
          {
            opacity: 0,
            x: dir.x,
            y: dir.y,
            z: dir.z,
            scale: 0.4,
            rotation: Math.random() * 40 - 20
          },
          {
            opacity: 1,
            x: 0,
            y: 0,
            z: 0,
            scale: 1,
            rotation: 0,
            duration: 2.8,
            ease: "power3.out"
          }
        );

        // Giữ lại một chút ở giữa rồi bay đi nhẹ
        gsap.to(wish, {
          delay: 2.8,
          duration: 2,
          opacity: 0,
          x: (Math.random() - 0.5) * 600,
          y: (Math.random() - 0.5) * 300,
          z: (Math.random() - 0.5) * 600,
          scale: 0.7,
          rotation: Math.random() * 30 - 15,
          ease: "power2.inOut",
          onComplete: () => {
            index++;
            showMessage();
          }
        });
      }
      setTimeout(showMessage, 1200);

      // === SPLIT HEART + FLOATING IMAGE ===
      function splitHeart() {
        const leftHalf = heart.clone();
        const rightHalf = heart.clone();
        scene.add(leftHalf, rightHalf);
        heart.visible = false;

        leftHalf.position.x = rightHalf.position.x = 0;
        gsap.to(leftHalf.position, {
          x: -14,
          z: -6,
          duration: 3,
          ease: "power2.inOut"
        });
        gsap.to(rightHalf.position, {
          x: 14,
          z: -6,
          duration: 3,
          ease: "power2.inOut"
        });
        gsap.to(leftHalf.rotation, {
          y: "-=1",
          duration: 3,
          ease: "power2.inOut"
        });
        gsap.to(rightHalf.rotation, {
          y: "+=1",
          duration: 3,
          ease: "power2.inOut"
        });

        // Tạo plane cho ảnh
        const texture = new THREE.TextureLoader().load("assets/letter.png");
        const planeGeo = new THREE.PlaneGeometry(14, 10);
        const planeMat = new THREE.MeshBasicMaterial({
          map: texture,
          transparent: true,
          opacity: 0
        });
        const girlPlane = new THREE.Mesh(planeGeo, planeMat);
        girlPlane.position.set(0, 0, 0);
        scene.add(girlPlane);

        // Ảnh xuất hiện dần
        gsap.to(planeMat, {
          opacity: 1,
          delay: 1.8,
          duration: 2.5,
          ease: "power3.out"
        });

        // Ảnh lơ lửng
        gsap.to(girlPlane.position, {
          y: "+=1.2",
          duration: 2,
          yoyo: true,
          repeat: -1,
          ease: "sine.inOut"
        });
        gsap.to(girlPlane.rotation, {
          y: "+=0.3",
          duration: 3.5,
          yoyo: true,
          repeat: -1,
          ease: "sine.inOut"
        });

        // Hai nửa trái tim vẫn dao động
        [leftHalf, rightHalf].forEach((half, i) => {
          gsap.to(half.position, {
            y: "+=1",
            duration: 1.8 + i * 0.3,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut"
          });
        });
      }

      // Resize
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
